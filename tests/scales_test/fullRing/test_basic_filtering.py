'''
This file is part of Satyrn.
Satyrn is free software: you can redistribute it and/or modify it under 
the terms of the GNU General Public License as published by the Free Software Foundation, 
either version 3 of the License, or (at your option) any later version.
Satyrn is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; 
without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. 
See the GNU General Public License for more details.
You should have received a copy of the GNU General Public License along with Satyrn. 
If not, see <https://www.gnu.org/licenses/>.
'''
import os

import requests

import unittest

from helper_func import make_results_url
import json

class TestFilter(unittest.TestCase):

    def setUp(self):

        self.apikey = os.environ.get("API_KEY", "thisisatestkey")
        self.url = os.environ.get("TEST_URL", "http://127.0.0.1:5000/")
        self.ringid = "90e114c2-ef05-490c-bdd8-f6f271a6733f"
        self.versionid = "1"
        self.headers ={
            "x-api-key": self.apikey
        }
    
    def test_filter_year(self):
        # ground truth verified
        opts = {"year": "2016"}

        urllink = make_results_url(self.url, self.ringid, self.versionid, "Case", "results", opts)

        resp = requests.get(urllink, headers=self.headers)
        results = json.loads(resp.content.decode('utf-8'))

        expected_results = {"totalCount": 346019, "page": 0, "batchSize": 10, "activeCacheRange": [0, 100], "results": [{"case_id": "2:16-cr-00105", "ucid": "flmd;;2:16-cr-00105", "header_case_id": "2:16-cr-00105-UA-MRM-1", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "1", "is_mdl": "False", "is_multi": "False", "filing_date": "2016-09-22", "terminating_date": "2016-09-23", "download_timestamp": "2020-02-01 09:36:52", "year": "2016", "case_name": "USA v. Johnson", "jury_demand": "None", "cause": "None", "jurisdiction": "None", "case_flags": "['CLOSED']", "case_duration": "1", "judge": "None", "referred_judges": "None", "case_type_id": "2", "city_id": "98", "court_id": "28", "nature_suit_id": "None", "state_id": "19", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.1", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}, {"case_id": "2:16-cr-00106", "ucid": "flmd;;2:16-cr-00106", "header_case_id": "2:16-cr-00106-SPC-CM-1", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "2", "is_mdl": "False", "is_multi": "False", "filing_date": "2016-09-23", "terminating_date": "2016-09-23", "download_timestamp": "2020-02-01 09:36:54", "year": "2016", "case_name": "USA v. Palma-Campos", "jury_demand": "None", "cause": "None", "jurisdiction": "None", "case_flags": "None", "case_duration": "0", "judge": "None", "referred_judges": "None", "case_type_id": "2", "city_id": "98", "court_id": "28", "nature_suit_id": "None", "state_id": "19", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.2", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}, {"case_id": "2:16-cr-00107", "ucid": "flmd;;2:16-cr-00107", "header_case_id": "2:16-cr-00107-JES-CM-1", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "1", "is_mdl": "False", "is_multi": "False", "filing_date": "2016-09-23", "terminating_date": "2016-09-23", "download_timestamp": "2020-02-01 09:36:56", "year": "2016", "case_name": "USA v. Leisinger", "jury_demand": "None", "cause": "None", "jurisdiction": "None", "case_flags": "['CLOSED']", "case_duration": "0", "judge": "None", "referred_judges": "None", "case_type_id": "2", "city_id": "98", "court_id": "28", "nature_suit_id": "None", "state_id": "19", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.1", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}, {"case_id": "2:16-cr-00108", "ucid": "flmd;;2:16-cr-00108", "header_case_id": "2:16-cr-00108-SPC-CM-1", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "4", "is_mdl": "False", "is_multi": "False", "filing_date": "2016-09-28", "terminating_date": "2017-10-03", "download_timestamp": "2020-02-01 09:36:59", "year": "2016", "case_name": "USA v. Dicks", "jury_demand": "None", "cause": "None", "jurisdiction": "None", "case_flags": "['CLOSED']", "case_duration": "370", "judge": "None", "referred_judges": "None", "case_type_id": "2", "city_id": "98", "court_id": "28", "nature_suit_id": "None", "state_id": "19", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.4", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}, {"case_id": "2:16-cr-00109", "ucid": "flmd;;2:16-cr-00109", "header_case_id": "2:16-cr-00109-JES-CM-1", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "7", "is_mdl": "False", "is_multi": "False", "filing_date": "2016-09-28", "terminating_date": "2018-11-13", "download_timestamp": "2020-02-01 09:37:01", "year": "2016", "case_name": "USA v. Mendleski", "jury_demand": "None", "cause": "None", "jurisdiction": "None", "case_flags": "['CLOSED']", "case_duration": "776", "judge": "None", "referred_judges": "None", "case_type_id": "2", "city_id": "98", "court_id": "28", "nature_suit_id": "None", "state_id": "19", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.7", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}, {"case_id": "2:16-cr-00111", "ucid": "flmd;;2:16-cr-00111", "header_case_id": "2:16-cr-00111-SPC-MRM-1", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "4", "is_mdl": "False", "is_multi": "False", "filing_date": "2016-09-28", "terminating_date": "2017-09-26", "download_timestamp": "2020-02-01 09:37:03", "year": "2016", "case_name": "USA v. Gladys", "jury_demand": "None", "cause": "None", "jurisdiction": "None", "case_flags": "['CLOSED']", "case_duration": "363", "judge": "None", "referred_judges": "None", "case_type_id": "2", "city_id": "98", "court_id": "28", "nature_suit_id": "None", "state_id": "19", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.4", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}, {"case_id": "2:16-cr-00112", "ucid": "flmd;;2:16-cr-00112", "header_case_id": "2:16-cr-00112-SPC-CM-1", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "3", "is_mdl": "False", "is_multi": "False", "filing_date": "2016-09-28", "terminating_date": "2017-02-08", "download_timestamp": "2020-02-01 09:37:06", "year": "2016", "case_name": "USA v. Teyul-Tut", "jury_demand": "None", "cause": "None", "jurisdiction": "None", "case_flags": "['CLOSED']", "case_duration": "133", "judge": "None", "referred_judges": "None", "case_type_id": "2", "city_id": "98", "court_id": "28", "nature_suit_id": "None", "state_id": "19", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.3", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}, {"case_id": "2:16-cr-00113", "ucid": "flmd;;2:16-cr-00113", "header_case_id": "2:16-cr-00113-SPC-MRM-1", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "3", "is_mdl": "False", "is_multi": "False", "filing_date": "2016-09-28", "terminating_date": "2017-04-12", "download_timestamp": "2020-02-01 09:37:08", "year": "2016", "case_name": "USA v. Barahona-Funes", "jury_demand": "None", "cause": "None", "jurisdiction": "None", "case_flags": "['CLOSED', 'INTERPRETER']", "case_duration": "196", "judge": "None", "referred_judges": "None", "case_type_id": "2", "city_id": "98", "court_id": "28", "nature_suit_id": "None", "state_id": "19", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.3", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}, {"case_id": "2:16-cr-00114", "ucid": "flmd;;2:16-cr-00114", "header_case_id": "2:16-cr-00114-SPC-CM-1", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "3", "is_mdl": "False", "is_multi": "False", "filing_date": "2016-09-28", "terminating_date": "2017-04-04", "download_timestamp": "2020-02-01 09:37:10", "year": "2016", "case_name": "USA v. Posey", "jury_demand": "None", "cause": "None", "jurisdiction": "None", "case_flags": "['CLOSED']", "case_duration": "188", "judge": "None", "referred_judges": "None", "case_type_id": "2", "city_id": "98", "court_id": "28", "nature_suit_id": "None", "state_id": "19", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.3", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}, {"case_id": "2:16-cr-00115", "ucid": "flmd;;2:16-cr-00115", "header_case_id": "2:16-cr-00115-JES-MRM-1", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "5", "is_mdl": "False", "is_multi": "False", "filing_date": "2016-09-28", "terminating_date": "2017-11-14", "download_timestamp": "2020-02-01 09:37:12", "year": "2016", "case_name": "USA v. Patterson", "jury_demand": "None", "cause": "None", "jurisdiction": "None", "case_flags": "['CLOSED']", "case_duration": "412", "judge": "None", "referred_judges": "None", "case_type_id": "2", "city_id": "98", "court_id": "28", "nature_suit_id": "None", "state_id": "19", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.5", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}]}
        self.assertEqual(expected_results, results)

    def test_filter_case_pacer_id(self):
        opts = {}
        json_opts = {
            "query": {
                "AND": [
                    [
                        {"entity": "Case",
                        "field": "case_pacer_id"},
                        "222255",
                        "exact"
                    ]
                ]
            },
            "relationships": []
        }
        urllink = make_results_url(self.url, self.ringid, self.versionid, "Case", "results", opts)

        resp = requests.get(urllink, headers=self.headers, json=json_opts)

        # resp = requests.get(urllink, headers=self.headers)
        results = json.loads(resp.content.decode('utf-8'))
        expected_results = {"totalCount": 1, "page": 0, "batchSize": 10, "activeCacheRange": [0, 100], "results": [{"case_id": "5:17-cr-00221", "ucid": "wvsd;;5:17-cr-00221", "header_case_id": "5:17-cr-00221 All Defendants", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "222255", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "11", "is_mdl": "False", "is_multi": "False", "filing_date": "2017-12-20", "terminating_date": "2018-08-23", "download_timestamp": "2021-07-28 23:26:40", "year": "None", "case_name": "United States of America v. Thomas et al", "jury_demand": "None", "cause": "None", "jurisdiction": "None", "case_flags": "['CLOSED', 'LC-1']", "case_duration": "246", "judge": "None", "referred_judges": "None", "case_type_id": "2", "city_id": "40", "court_id": "10", "nature_suit_id": "None", "state_id": "6", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "1.1", "n_docket_reports": "1", "download_url": "https://ecf.wvsd.uscourts.gov/cgi-bin/DktRpt.pl?785027948422826-L_1_0-1", "docket_available": "True"}]}
        self.assertEqual(expected_results, results)

    def test_filter_terminating_date(self):
        opts = {}
        json_opts = {
            "query": {
                "AND": [
                    [
                        {"entity": "Case",
                        "field": "terminating_date"},
                        "2018-08-23",
                        "exact"
                    ]
                ]
            },
            "relationships": []
        }
        urllink = make_results_url(self.url, self.ringid, self.versionid, "Case", "results", opts)

        resp = requests.get(urllink, headers=self.headers, json=json_opts)

        # resp = requests.get(urllink, headers=self.headers)
        results = json.loads(resp.content.decode('utf-8'))
        expected_results = {"totalCount": 434, "page": 0, "batchSize": 10, "activeCacheRange": [0, 100], "results": [{"case_id": "2:16-cr-00022", "ucid": "cacd;;2:16-cr-00022", "header_case_id": "2:16-cr-00022-DMG-1", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "9", "is_mdl": "False", "is_multi": "False", "filing_date": "2016-01-22", "terminating_date": "2018-08-23", "download_timestamp": "2020-01-30 23:20:29", "year": "2016", "case_name": "USA v. Vasquez", "jury_demand": "None", "cause": "None", "jurisdiction": "None", "case_flags": "['WESTERN', 'CLOSED']", "case_duration": "944", "judge": "None", "referred_judges": "None", "case_type_id": "2", "city_id": "189", "court_id": "60", "nature_suit_id": "None", "state_id": "37", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.9", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}, {"case_id": "2:16-cv-00096", "ucid": "txed;;2:16-cv-00096", "header_case_id": "2:16-cv-00096-RWS-RSP", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "4", "is_mdl": "False", "is_multi": "False", "filing_date": "2016-01-29", "terminating_date": "2018-08-23", "download_timestamp": "2020-10-11 11:02:16", "year": "2016", "case_name": "Global Equity Management (SA) Pty. Ltd. v. Hotels.com, L.P. et al", "jury_demand": "Plaintiff", "cause": "35:271 Patent Infringement", "jurisdiction": "Federal Question", "case_flags": "['CASREF', 'CLOSED', 'CONSOL', 'RWS2', 'STAYED']", "case_duration": "937", "judge": "District Judge Robert W. Schroeder, III", "referred_judges": "['Magistrate Judge Roy S. Payne']", "case_type_id": "1", "city_id": "190", "court_id": "59", "nature_suit_id": "77", "state_id": "36", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.4", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}, {"case_id": "1:16-cv-01652", "ucid": "insd;;1:16-cv-01652", "header_case_id": "1:16-cv-01652-WTL-TAB", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "4", "is_mdl": "False", "is_multi": "True", "filing_date": "2016-06-24", "terminating_date": "2018-08-23", "download_timestamp": "2019-08-27 17:49:51", "year": "2016", "case_name": "HUNTER v. UNITED STATES OF AMERICA", "jury_demand": "None", "cause": "28:2255 Motion to Vacate", "jurisdiction": "U.S. Government Defendant", "case_flags": "['MANDATE', 'CLOSED']", "case_duration": "790", "judge": "Judge William T. Lawrence", "referred_judges": "['Magistrate Judge Tim A. Baker']", "case_type_id": "1", "city_id": "187", "court_id": "58", "nature_suit_id": "46", "state_id": "35", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.4", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}, {"case_id": "2:16-cv-00619", "ucid": "txed;;2:16-cv-00619", "header_case_id": "2:16-cv-00619-RWS-RSP", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "5", "is_mdl": "False", "is_multi": "False", "filing_date": "2016-06-14", "terminating_date": "2018-08-23", "download_timestamp": "2020-10-11 11:02:27", "year": "2016", "case_name": "Global Equity Management (SA) Pty. Ltd. v. Johnson & Johnson USA, Inc.", "jury_demand": "Both", "cause": "35:183 Patent Infringement", "jurisdiction": "Federal Question", "case_flags": "['CASREF', 'CLOSED', 'CONSOL', 'JURY', 'RWS2']", "case_duration": "800", "judge": "District Judge Robert W. Schroeder, III", "referred_judges": "['Magistrate Judge Roy S. Payne']", "case_type_id": "1", "city_id": "190", "court_id": "59", "nature_suit_id": "77", "state_id": "36", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.5", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}, {"case_id": "2:16-cv-00629", "ucid": "txed;;2:16-cv-00629", "header_case_id": "2:16-cv-00629-RWS-RSP", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "5", "is_mdl": "False", "is_multi": "False", "filing_date": "2016-06-14", "terminating_date": "2018-08-23", "download_timestamp": "2020-10-11 11:01:51", "year": "2016", "case_name": "Global Equity Management (SA) Pty. Ltd. v. Zynga, Inc.", "jury_demand": "Both", "cause": "35:183 Patent Infringement", "jurisdiction": "Federal Question", "case_flags": "['CASREF', 'CLOSED', 'CONSOL', 'JURY', 'RWS2']", "case_duration": "800", "judge": "District Judge Robert W. Schroeder, III", "referred_judges": "['Magistrate Judge Roy S. Payne']", "case_type_id": "1", "city_id": "190", "court_id": "59", "nature_suit_id": "77", "state_id": "36", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.5", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}, {"case_id": "2:16-cv-00632", "ucid": "txed;;2:16-cv-00632", "header_case_id": "2:16-cv-00632-RWS-RSP", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "5", "is_mdl": "False", "is_multi": "False", "filing_date": "2016-06-14", "terminating_date": "2018-08-23", "download_timestamp": "2020-10-11 10:33:02", "year": "2016", "case_name": "Global Equity Management (SA) Pty. Ltd. v. Artek Surfin Chemicals, Ltd. (d/b/a Galata Chemicals, LLC)", "jury_demand": "Both", "cause": "35:183 Patent Infringement", "jurisdiction": "Federal Question", "case_flags": "['CASREF', 'CLOSED', 'CONSOL', 'JURY', 'RWS2']", "case_duration": "800", "judge": "District Judge Robert W. Schroeder, III", "referred_judges": "['Magistrate Judge Roy S. Payne']", "case_type_id": "1", "city_id": "190", "court_id": "59", "nature_suit_id": "77", "state_id": "36", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.5", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}, {"case_id": "2:16-cv-00634", "ucid": "txed;;2:16-cv-00634", "header_case_id": "2:16-cv-00634-RWS-RSP", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "5", "is_mdl": "False", "is_multi": "False", "filing_date": "2016-06-14", "terminating_date": "2018-08-23", "download_timestamp": "2020-10-11 10:33:06", "year": "2016", "case_name": "Global Equity Management (SA) Pty. Ltd. v. AdRoll, Inc.", "jury_demand": "Both", "cause": "35:183 Patent Infringement", "jurisdiction": "Federal Question", "case_flags": "['CASREF', 'CLOSED', 'CONSOL', 'JURY', 'RWS2']", "case_duration": "800", "judge": "District Judge Robert W. Schroeder, III", "referred_judges": "['Magistrate Judge Roy S. Payne']", "case_type_id": "1", "city_id": "190", "court_id": "59", "nature_suit_id": "77", "state_id": "36", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.5", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}, {"case_id": "2:16-cv-00830", "ucid": "txed;;2:16-cv-00830", "header_case_id": "2:16-cv-00830-JRG-RSP", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "8", "is_mdl": "False", "is_multi": "False", "filing_date": "2016-07-29", "terminating_date": "2018-08-23", "download_timestamp": "None", "year": "2016", "case_name": "Custom Game Design Software, Inc. v. Katob d/b/a Mo's Vending et al", "jury_demand": "Defendant", "cause": "15:1051 Trademark Infringement", "jurisdiction": "Federal Question", "case_flags": "['CASREF', 'CLOSED', 'JRG1', 'JURY', 'PROTECTIVE-ORDER', 'STAYDDLS']", "case_duration": "755", "judge": "Judge Rodney Gilstrap", "referred_judges": "['Magistrate Judge Roy S. Payne']", "case_type_id": "1", "city_id": "190", "court_id": "59", "nature_suit_id": "18", "state_id": "36", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.8", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}, {"case_id": "1:16-cv-01479", "ucid": "gand;;1:16-cv-01479", "header_case_id": "1:16-cv-01479-ODE", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "8", "is_mdl": "False", "is_multi": "True", "filing_date": "2016-05-06", "terminating_date": "2018-08-23", "download_timestamp": "2019-08-23 18:49:57", "year": "2016", "case_name": "Parker v. Wal-Mart Stores, Inc. et al", "jury_demand": "Both", "cause": "28:1441 Petition for Removal- Personal Injury", "jurisdiction": "Diversity", "case_flags": "['4months', 'CLOSED', 'PROTO']", "case_duration": "839", "judge": "Judge Orinda D. Evans", "referred_judges": "None", "case_type_id": "1", "city_id": "176", "court_id": "54", "nature_suit_id": "14", "state_id": "32", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.8", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}, {"case_id": "1:17-cr-00184", "ucid": "insd;;1:17-cr-00184", "header_case_id": "1:17-cr-00184-JRS-TAB-1", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "77355", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "4", "is_mdl": "False", "is_multi": "False", "filing_date": "2017-09-07", "terminating_date": "2018-08-23", "download_timestamp": "2021-08-30 19:03:24", "year": "None", "case_name": "USA v. ALLEN, JR.", "jury_demand": "None", "cause": "None", "jurisdiction": "None", "case_flags": "['CLOSED']", "case_duration": "350", "judge": "None", "referred_judges": "None", "case_type_id": "2", "city_id": "187", "court_id": "58", "nature_suit_id": "None", "state_id": "35", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.4", "n_docket_reports": "1", "download_url": "https://ecf.insd.uscourts.gov/cgi-bin/DktRpt.pl?122947016391346-L_1_0-1", "docket_available": "True"}]}
        self.assertEqual(expected_results, results)

    def test_filter_CaseType_CaseTargetEntity(self):
        opts = {}
        json_opts = {
            "query": {
                "AND": [
                    [
                        {"entity": "CaseType",
                        "field": "name"},
                        "cv",
                        "exact"
                    ]
                ]
            },
            "relationships": ["CaseToType"]
        }
        urllink = make_results_url(self.url, self.ringid, self.versionid, "Case", "results", opts)

        resp = requests.get(urllink, headers=self.headers, json=json_opts)

        # resp = requests.get(urllink, headers=self.headers)
        results = json.loads(resp.content.decode('utf-8'))
        expected_results = {"totalCount": 720793, "page": 0, "batchSize": 10, "activeCacheRange": [0, 100], "results": [{"case_id": "3:16-cv-00159", "ucid": "innd;;3:16-cv-00159", "header_case_id": "3:16-cv-00159-RLM-MGG", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "85823", "recap_id": "None", "monetary_demand": "75000.0", "mdl_code": "2391", "billable_pages": "3", "is_mdl": "True", "is_multi": "True", "filing_date": "2016-03-18", "terminating_date": "2018-12-12", "download_timestamp": "2021-07-08 01:22:15", "year": "2016", "case_name": "Smith v. Biomet Orthopedics LLC et al", "jury_demand": "Both", "cause": "28:1332 Diversity-Product Liability", "jurisdiction": "Diversity", "case_flags": "['CASREF', 'MDL', 'MDL-2391', 'TERMED', 'TRANSF']", "case_duration": "999", "judge": "Judge Robert L Miller, Jr", "referred_judges": "['Magistrate Judge Michael G Gotsch, Sr']", "case_type_id": "1", "city_id": "186", "court_id": "57", "nature_suit_id": "57", "state_id": "35", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "flag", "source": "pacer", "cost": "0.3", "n_docket_reports": "2", "download_url": "https://ecf.innd.uscourts.gov/cgi-bin/DktRpt.pl?111091708229922-L_1_0-1", "docket_available": "True"}, {"case_id": "3:16-cv-00160", "ucid": "innd;;3:16-cv-00160", "header_case_id": "3:16-cv-00160-PPS", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "2", "is_mdl": "False", "is_multi": "False", "filing_date": "2016-03-18", "terminating_date": "2017-06-08", "download_timestamp": "2019-08-26 21:45:23", "year": "2016", "case_name": "Twitty v. Superintendent", "jury_demand": "None", "cause": "28:2254 Petition for Writ of Habeas Corpus (State)", "jurisdiction": "Federal Question", "case_flags": "['HABEAS', 'TERMED']", "case_duration": "447", "judge": "Chief Judge Philip P Simon", "referred_judges": "None", "case_type_id": "1", "city_id": "186", "court_id": "57", "nature_suit_id": "12", "state_id": "35", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.2", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}, {"case_id": "3:16-cv-00161", "ucid": "innd;;3:16-cv-00161", "header_case_id": "3:16-cv-00161-JVB-CAN", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "3", "is_mdl": "False", "is_multi": "True", "filing_date": "2016-03-18", "terminating_date": "2016-06-14", "download_timestamp": "2019-08-26 21:45:30", "year": "2016", "case_name": "Bickel v. Carrington Mortgage Services LLC et al", "jury_demand": "None", "cause": "28:1441 Petition for Removal - Fair Credit Reporting", "jurisdiction": "Federal Question", "case_flags": "['CASREF', 'TERMED']", "case_duration": "88", "judge": "Judge Joseph S Van Bokkelen", "referred_judges": "['Magistrate Judge Christopher A Nuechterlein']", "case_type_id": "1", "city_id": "186", "court_id": "57", "nature_suit_id": "43", "state_id": "35", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.3", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}, {"case_id": "3:16-cv-00162", "ucid": "innd;;3:16-cv-00162", "header_case_id": "3:16-cv-00162-RLM-MGG", "lead_case_pacer_id": "71286", "lead_case_id": "3:12-md-02391-RLM-MGG", "member_case_key": "innd;;3:12-md-02391", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "None", "mdl_code": "2391", "billable_pages": "11", "is_mdl": "True", "is_multi": "True", "filing_date": "2016-03-18", "terminating_date": "2018-02-09", "download_timestamp": "2019-08-26 21:45:37", "year": "2016", "case_name": "Webb v. Biomet, Inc. et al", "jury_demand": "Both", "cause": "28:1332 Diversity-Product Liability", "jurisdiction": "Diversity", "case_flags": "['MDL', 'MDL-2391', 'TERMED']", "case_duration": "693", "judge": "Judge Robert L Miller, Jr", "referred_judges": "['Magistrate Judge Michael G Gotsch, Sr']", "case_type_id": "1", "city_id": "186", "court_id": "57", "nature_suit_id": "57", "state_id": "35", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "lead_case_id", "source": "pacer", "cost": "1.1", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}, {"case_id": "3:16-cv-00163", "ucid": "innd;;3:16-cv-00163", "header_case_id": "3:16-cv-00163-RLM-MGG", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "3", "is_mdl": "False", "is_multi": "True", "filing_date": "2016-03-21", "terminating_date": "2016-10-20", "download_timestamp": "2019-08-26 21:45:45", "year": "2016", "case_name": "Washington v. Nu-Way Transportation Services, Inc. et al", "jury_demand": "Both", "cause": "28:1332 Diversity-Petition for Removal", "jurisdiction": "Diversity", "case_flags": "['CASREF', 'TERMED']", "case_duration": "213", "judge": "Judge Robert L Miller, Jr", "referred_judges": "['Magistrate Judge Michael G Gotsch, Sr']", "case_type_id": "1", "city_id": "186", "court_id": "57", "nature_suit_id": "13", "state_id": "35", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.3", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}, {"case_id": "3:16-cv-00164", "ucid": "innd;;3:16-cv-00164", "header_case_id": "3:16-cv-00164-JVB-MGG", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "2", "is_mdl": "False", "is_multi": "True", "filing_date": "2016-03-21", "terminating_date": "2016-10-14", "download_timestamp": "2019-08-26 21:45:52", "year": "2016", "case_name": "Ruiz et al v. Pekin Insurance Company", "jury_demand": "Both", "cause": "28:1332 Diversity-Petition for Removal", "jurisdiction": "Diversity", "case_flags": "['CASREF', 'TERMED']", "case_duration": "207", "judge": "Judge Joseph S Van Bokkelen", "referred_judges": "['Magistrate Judge Michael G Gotsch, Sr']", "case_type_id": "1", "city_id": "186", "court_id": "57", "nature_suit_id": "38", "state_id": "35", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.2", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}, {"case_id": "3:16-cv-00165", "ucid": "innd;;3:16-cv-00165", "header_case_id": "3:16-cv-00165-TLS-CAN", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "1000000.0", "mdl_code": "None", "billable_pages": "2", "is_mdl": "False", "is_multi": "False", "filing_date": "2016-03-21", "terminating_date": "2016-08-29", "download_timestamp": "2019-08-26 21:46:05", "year": "2016", "case_name": "Peavy v. Peoples et al", "jury_demand": "Plaintiff", "cause": "42:1983 Prisoner Civil Rights", "jurisdiction": "Federal Question", "case_flags": "['CASREF', 'TERMED']", "case_duration": "161", "judge": "Chief Judge Theresa L Springmann", "referred_judges": "['Magistrate Judge Christopher A Nuechterlein']", "case_type_id": "1", "city_id": "186", "court_id": "57", "nature_suit_id": "11", "state_id": "35", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.2", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}, {"case_id": "3:16-cv-00166", "ucid": "innd;;3:16-cv-00166", "header_case_id": "3:16-cv-00166-JTM", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "2", "is_mdl": "False", "is_multi": "False", "filing_date": "2016-03-21", "terminating_date": "2017-05-30", "download_timestamp": "2019-08-26 21:46:10", "year": "2016", "case_name": "Robinson v. Superintendent", "jury_demand": "None", "cause": "28:2254 Petition for Writ of Habeas Corpus (State)", "jurisdiction": "Federal Question", "case_flags": "['HABEAS', 'TERMED']", "case_duration": "435", "judge": "Senior Judge James T Moody", "referred_judges": "None", "case_type_id": "1", "city_id": "186", "court_id": "57", "nature_suit_id": "12", "state_id": "35", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.2", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}, {"case_id": "3:16-cv-00167", "ucid": "innd;;3:16-cv-00167", "header_case_id": "3:16-cv-00167-JD-MGG", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "4", "is_mdl": "False", "is_multi": "False", "filing_date": "2016-03-21", "terminating_date": "2017-08-15", "download_timestamp": "2019-08-26 21:46:18", "year": "2016", "case_name": "Anglemyer v. Commissioner of Social Security", "jury_demand": "None", "cause": "42:405 Review of HHS Decision (SSID)", "jurisdiction": "U.S. Government Defendant", "case_flags": "['CASREF', 'REMAND', 'TERMED']", "case_duration": "512", "judge": "Judge Jon E DeGuilio", "referred_judges": "['Magistrate Judge Michael G Gotsch, Sr']", "case_type_id": "1", "city_id": "186", "court_id": "57", "nature_suit_id": "6", "state_id": "35", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.4", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}, {"case_id": "3:16-cv-00168", "ucid": "innd;;3:16-cv-00168", "header_case_id": "3:16-cv-00168-RL-JEM", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "1000000.0", "mdl_code": "None", "billable_pages": "3", "is_mdl": "False", "is_multi": "True", "filing_date": "2016-03-22", "terminating_date": "2016-10-05", "download_timestamp": "2019-08-26 21:46:29", "year": "2016", "case_name": "Trevino v. Bowman et al", "jury_demand": "Plaintiff", "cause": "42:1983 Prisoner Civil Rights", "jurisdiction": "Federal Question", "case_flags": "['CASREF', 'REOPEN', 'TERMED']", "case_duration": "197", "judge": "Judge Rudy Lozano", "referred_judges": "['Magistrate Judge John E Martin']", "case_type_id": "1", "city_id": "186", "court_id": "57", "nature_suit_id": "11", "state_id": "35", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.3", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}]}
        self.assertEqual(expected_results, results)

    def test_filter_year_type(self):
        opts = {}
        json_opts = {
            "query": {
                "AND": [
                    [
                        {"entity": "CaseType",
                        "field": "name"},
                        "cv",
                        "exact"
                    ],
                    [
                        {"entity": "Case",
                        "field": "year"},
                        2016,
                        "exact"
                    ]
                ]
            },
            "relationships": ["CaseToType"]
        }
        urllink = make_results_url(self.url, self.ringid, self.versionid, "Case", "results", opts)
        resp = requests.get(urllink, headers=self.headers, json=json_opts)
        results = json.loads(resp.content.decode('utf-8'))
        expected_results = {"totalCount": 279517, "page": 0, "batchSize": 10, "activeCacheRange": [0, 100], "results": [{"case_id": "5:16-cv-02534", "ucid": "cacd;;5:16-cv-02534", "header_case_id": "5:16-cv-02534-KK", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "3", "is_mdl": "False", "is_multi": "False", "filing_date": "2016-12-08", "terminating_date": "2017-08-31", "download_timestamp": "None", "year": "2016", "case_name": "Julie Driskell v. Carolyn W. Colvin", "jury_demand": "None", "cause": "42:405 Review of HHS Decision (DIWC)", "jurisdiction": "U.S. Government Defendant", "case_flags": "['ACCO', 'CLOSED', 'CONMAG']", "case_duration": "266", "judge": "Magistrate Judge Kenly Kiya Kato", "referred_judges": "None", "case_type_id": "1", "city_id": "217", "court_id": "60", "nature_suit_id": "17", "state_id": "37", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.3", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}, {"case_id": "5:16-cv-02535", "ucid": "cacd;;5:16-cv-02535", "header_case_id": "5:16-cv-02535-JGB-JC", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "664819", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "6", "is_mdl": "False", "is_multi": "False", "filing_date": "2016-12-08", "terminating_date": "2018-03-22", "download_timestamp": "2021-10-07 16:49:42", "year": "2016", "case_name": "Kirk Clymer v. City of Adelanto et al", "jury_demand": "Defendant", "cause": "42:1983 Civil Rights Act", "jurisdiction": "Federal Question", "case_flags": "['ACCO', '(JCx)', 'CLOSED', 'DISCOVERY', 'MANADR']", "case_duration": "469", "judge": "Judge Jesus G. Bernal", "referred_judges": "['Magistrate Judge Jacqueline Chooljian']", "case_type_id": "1", "city_id": "217", "court_id": "60", "nature_suit_id": "3", "state_id": "37", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.6", "n_docket_reports": "1", "download_url": "https://ecf.cacd.uscourts.gov/cgi-bin/DktRpt.pl?17657040689426-L_1_0-1", "docket_available": "True"}, {"case_id": "5:16-cv-02536", "ucid": "cacd;;5:16-cv-02536", "header_case_id": "5:16-cv-02536-JFW-KK", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "2000.0", "mdl_code": "None", "billable_pages": "4", "is_mdl": "False", "is_multi": "False", "filing_date": "2016-12-08", "terminating_date": "2017-06-13", "download_timestamp": "None", "year": "2016", "case_name": "Paul McMullen v. Target Corporation", "jury_demand": "Plaintiff", "cause": "28:1441 Notice of Removal - Fair Credit Reporting Act", "jurisdiction": "Federal Question", "case_flags": "['ACCO', '(KKx)', 'CLOSED', 'DISCOVERY', 'MANADR']", "case_duration": "187", "judge": "Judge John F. Walter", "referred_judges": "['Magistrate Judge Kenly Kiya Kato']", "case_type_id": "1", "city_id": "217", "court_id": "60", "nature_suit_id": "43", "state_id": "37", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.4", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}, {"case_id": "5:16-cv-02537", "ucid": "cacd;;5:16-cv-02537", "header_case_id": "5:16-cv-02537-RGK-SP", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "3", "is_mdl": "False", "is_multi": "False", "filing_date": "2016-12-08", "terminating_date": "2017-01-25", "download_timestamp": "None", "year": "2016", "case_name": "Jonathan C. Jones et al v. Amie Yvonne Cardenas et al", "jury_demand": "None", "cause": "28:1443(1) Notice of Removal - Rent", "jurisdiction": "Federal Question", "case_flags": "['(SPx)', 'CLOSED', 'DISCOVERY', 'MANADR', 'REMANDED']", "case_duration": "48", "judge": "Judge R. Gary Klausner", "referred_judges": "['Magistrate Judge Sheri Pym']", "case_type_id": "1", "city_id": "217", "court_id": "60", "nature_suit_id": "40", "state_id": "37", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.3", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}, {"case_id": "5:16-cv-02538", "ucid": "cacd;;5:16-cv-02538", "header_case_id": "5:16-cv-02538-JGB-KK", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "3", "is_mdl": "False", "is_multi": "False", "filing_date": "2016-12-08", "terminating_date": "2017-02-14", "download_timestamp": "2020-10-11 04:48:12", "year": "2016", "case_name": "Sream, Inc. v. Kenneth Walsh et al", "jury_demand": "Plaintiff", "cause": "15:1051 Trademark Infringement", "jurisdiction": "Federal Question", "case_flags": "['ACCO', '(KKx)', 'CLOSED', 'DISCOVERY', 'MANADR']", "case_duration": "68", "judge": "Judge Jesus G. Bernal", "referred_judges": "['Magistrate Judge Kenly Kiya Kato']", "case_type_id": "1", "city_id": "217", "court_id": "60", "nature_suit_id": "18", "state_id": "37", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.3", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}, {"case_id": "5:16-cv-02539", "ucid": "cacd;;5:16-cv-02539", "header_case_id": "5:16-cv-02539-JGB-SP", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "3000.0", "mdl_code": "None", "billable_pages": "2", "is_mdl": "False", "is_multi": "False", "filing_date": "2016-12-09", "terminating_date": "2017-03-13", "download_timestamp": "2020-01-31 03:18:55", "year": "2016", "case_name": "Cheryl Schuster v. Asset Recovery Associates, Inc et al", "jury_demand": "Plaintiff", "cause": "15:1692 Fair Debt Collection Act", "jurisdiction": "Federal Question", "case_flags": "['ACCO', '(SPx)', 'CLOSED', 'DISCOVERY', 'MANADR']", "case_duration": "94", "judge": "Judge Jesus G. Bernal", "referred_judges": "['Magistrate Judge Sheri Pym']", "case_type_id": "1", "city_id": "217", "court_id": "60", "nature_suit_id": "43", "state_id": "37", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.2", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}, {"case_id": "5:16-cv-02540", "ucid": "cacd;;5:16-cv-02540", "header_case_id": "5:16-cv-02540-RGK-PLA", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "664918", "recap_id": "None", "monetary_demand": "500000.0", "mdl_code": "None", "billable_pages": "5", "is_mdl": "False", "is_multi": "True", "filing_date": "2016-12-09", "terminating_date": "2017-04-25", "download_timestamp": "2021-10-07 16:34:22", "year": "2016", "case_name": "Judith E. Owens et al v. Debra Hurst et al", "jury_demand": "None", "cause": "28:1441 Notice of Removal - Civil Rights Act", "jurisdiction": "Federal Question", "case_flags": "['ACCO', '194', 'CLOSED']", "case_duration": "137", "judge": "Judge R. Gary Klausner", "referred_judges": "['Magistrate Judge Paul L. Abrams']", "case_type_id": "1", "city_id": "217", "court_id": "60", "nature_suit_id": "3", "state_id": "37", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.5", "n_docket_reports": "1", "download_url": "https://ecf.cacd.uscourts.gov/cgi-bin/DktRpt.pl?156123633111826-L_1_0-1", "docket_available": "True"}, {"case_id": "5:16-cv-02541", "ucid": "cacd;;5:16-cv-02541", "header_case_id": "5:16-cv-02541-JGB-DTB", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "4", "is_mdl": "False", "is_multi": "False", "filing_date": "2016-12-09", "terminating_date": "2017-02-21", "download_timestamp": "None", "year": "2016", "case_name": "Jose G. Loera v. Carmax Auto Superstores California, LLC", "jury_demand": "Both", "cause": "28:1346  Breach of Contract", "jurisdiction": "Federal Question", "case_flags": "['ACCO', '(DTBx)', 'CLOSED', 'DISCOVERY', 'MANADR']", "case_duration": "74", "judge": "Judge Jesus G. Bernal", "referred_judges": "['Magistrate Judge David T. Bristow']", "case_type_id": "1", "city_id": "217", "court_id": "60", "nature_suit_id": "31", "state_id": "37", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.4", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}, {"case_id": "5:16-cv-02542", "ucid": "cacd;;5:16-cv-02542", "header_case_id": "5:16-cv-02542-ODW-SP", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "92000.0", "mdl_code": "None", "billable_pages": "3", "is_mdl": "False", "is_multi": "True", "filing_date": "2016-12-09", "terminating_date": "2017-02-22", "download_timestamp": "2020-01-31 03:18:57", "year": "2016", "case_name": "James R. Cravens v. Sterigenics International, Inc. et al", "jury_demand": "Plaintiff", "cause": "28:1442 Notice of Removal", "jurisdiction": "Diversity", "case_flags": "['ACCO', '(SPx)', 'CLOSED', 'DISCOVERY', 'MANADR']", "case_duration": "75", "judge": "Judge Otis D. Wright, II", "referred_judges": "['Magistrate Judge Sheri Pym']", "case_type_id": "1", "city_id": "217", "court_id": "60", "nature_suit_id": "1", "state_id": "37", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.3", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}, {"case_id": "5:16-cv-02543", "ucid": "cacd;;5:16-cv-02543", "header_case_id": "5:16-cv-02543-R-SP", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "3", "is_mdl": "False", "is_multi": "False", "filing_date": "2016-12-09", "terminating_date": "2017-04-27", "download_timestamp": "2020-10-11 04:49:35", "year": "2016", "case_name": "Blumenthal Distributing, Inc. v. K and B Furniture Co., Inc. et al", "jury_demand": "Plaintiff", "cause": "35:145 Patent Infringement", "jurisdiction": "Federal Question", "case_flags": "['ACCO', '(SPx)', 'CLOSED', 'DISCOVERY']", "case_duration": "139", "judge": "Judge Manuel L. Real", "referred_judges": "['Magistrate Judge Sheri Pym']", "case_type_id": "1", "city_id": "217", "court_id": "60", "nature_suit_id": "77", "state_id": "37", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.3", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}]}
        self.assertEqual(expected_results, results)

    def test_filter_fail_no_result(self):
        opts = {"year": "20132312320"}
        urllink = make_results_url(self.url, self.ringid, self.versionid, "Case", "results", opts)

        resp = requests.get(urllink, headers=self.headers)
        results = json.loads(resp.content.decode('utf-8'))
        expected_results = {'totalCount': 0, 'page': 0, 'batchSize': 10, 'activeCacheRange': [0, 100], 'results': []}
        self.assertEqual(expected_results, results)

    def test_filter_area_contains(self):
        # ground truth verified
        opts = {"batchSize": 5}
        json_opts = {
            "query": {
                "AND": [
                    [
                        {"entity": "Case",
                        "field": "jurisdiction"},
                        "Federal",
                        "contains"
                    ]
                ]
            },
            "relationships": []
        }
        urllink = make_results_url(self.url, self.ringid, self.versionid, "Case", "results", opts)

        resp = requests.get(urllink, headers=self.headers, json=json_opts)

        results = json.loads(resp.content.decode('utf-8'))
        expected_results = {"totalCount": 399539, "page": 0, "batchSize": 5, "activeCacheRange": [0, 50], "results": [{"case_id": "5:17-cv-00223", "ucid": "cacd;;5:17-cv-00223", "header_case_id": "5:17-cv-00223-ODW-AGR", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "669868", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "4", "is_mdl": "False", "is_multi": "False", "filing_date": "2017-02-06", "terminating_date": "2017-07-24", "download_timestamp": "2021-07-26 20:27:31", "year": "None", "case_name": "Jarrod Gordon v. S. Martinez et al", "jury_demand": "Plaintiff", "cause": "42:1983 Prisoner Civil Rights", "jurisdiction": "Federal Question", "case_flags": "['194', 'CLOSED', 'RELATED-DDJ', 'RELATED-G']", "case_duration": "168", "judge": "Judge Otis D. Wright, II", "referred_judges": "['Magistrate Judge Alicia G. Rosenberg']", "case_type_id": "1", "city_id": "217", "court_id": "60", "nature_suit_id": "11", "state_id": "37", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.4", "n_docket_reports": "1", "download_url": "https://ecf.cacd.uscourts.gov/cgi-bin/DktRpt.pl?416487562103601-L_1_0-1", "docket_available": "True"}, {"case_id": "5:17-cv-00224", "ucid": "cacd;;5:17-cv-00224", "header_case_id": "5:17-cv-00224-JGB-KK", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "669596", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "3", "is_mdl": "False", "is_multi": "False", "filing_date": "2017-02-06", "terminating_date": "2017-05-19", "download_timestamp": "2021-07-26 20:27:38", "year": "None", "case_name": "Reginald Oden v. Kroger Co The", "jury_demand": "Plaintiff", "cause": "28:1331 Fed. Question", "jurisdiction": "Federal Question", "case_flags": "['ACCO', '(KKx)', 'CLOSED', 'DISCOVERY', 'MANADR']", "case_duration": "102", "judge": "Judge Jesus G. Bernal", "referred_judges": "['Magistrate Judge Kenly Kiya Kato']", "case_type_id": "1", "city_id": "217", "court_id": "60", "nature_suit_id": "7", "state_id": "37", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.3", "n_docket_reports": "1", "download_url": "https://ecf.cacd.uscourts.gov/cgi-bin/DktRpt.pl?930923125442693-L_1_0-1", "docket_available": "True"}, {"case_id": "5:17-cv-00226", "ucid": "cacd;;5:17-cv-00226", "header_case_id": "5:17-cv-00226-JGB-DTB", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "669602", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "4", "is_mdl": "False", "is_multi": "False", "filing_date": "2017-02-06", "terminating_date": "2017-11-07", "download_timestamp": "2021-07-26 20:27:50", "year": "None", "case_name": "Center for Community Action and Environmental Justice v. Mill Man Steel, Inc.", "jury_demand": "None", "cause": "33:1319 Clean Water Act", "jurisdiction": "Federal Question", "case_flags": "['ACCO', '(DTBx)', 'CLOSED', 'DISCOVERY', 'MANADR']", "case_duration": "274", "judge": "Judge Jesus G. Bernal", "referred_judges": "['Magistrate Judge David T. Bristow']", "case_type_id": "1", "city_id": "217", "court_id": "60", "nature_suit_id": "44", "state_id": "37", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.4", "n_docket_reports": "1", "download_url": "https://ecf.cacd.uscourts.gov/cgi-bin/DktRpt.pl?770859538303589-L_1_0-1", "docket_available": "True"}, {"case_id": "5:17-cv-00227", "ucid": "cacd;;5:17-cv-00227", "header_case_id": "5:17-cv-00227-DSF-RAO", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "669997", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "3", "is_mdl": "False", "is_multi": "False", "filing_date": "2017-02-07", "terminating_date": "2017-07-31", "download_timestamp": "2021-07-26 20:27:56", "year": "None", "case_name": "Jose Saldivar Ureno v. Stu Sherman", "jury_demand": "None", "cause": "28:2254 Petition for Writ of Habeas Corpus (State)", "jurisdiction": "Federal Question", "case_flags": "['194', 'CLOSED', 'RELATED-DDJ']", "case_duration": "174", "judge": "Judge Dale S. Fischer", "referred_judges": "['Magistrate Judge Rozella A. Oliver']", "case_type_id": "1", "city_id": "217", "court_id": "60", "nature_suit_id": "12", "state_id": "37", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.3", "n_docket_reports": "1", "download_url": "https://ecf.cacd.uscourts.gov/cgi-bin/DktRpt.pl?127194558904365-L_1_0-1", "docket_available": "True"}, {"case_id": "5:17-cv-00228", "ucid": "cacd;;5:17-cv-00228", "header_case_id": "5:17-cv-00228-MWF-SP", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "669645", "recap_id": "None", "monetary_demand": "6000000.0", "mdl_code": "None", "billable_pages": "14", "is_mdl": "False", "is_multi": "True", "filing_date": "2017-02-07", "terminating_date": "2017-05-03", "download_timestamp": "2021-07-26 20:28:02", "year": "None", "case_name": "Liberty Mutual First Insurance Company et al v. Ez-Flo International, Inc. et al", "jury_demand": "Plaintiff", "cause": "28:1441 Notice of Removal - Property Damage", "jurisdiction": "Federal Question", "case_flags": "['ACCO', '(SPx)', 'CLOSED', 'DISCOVERY', 'MANADR', 'REMANDED']", "case_duration": "85", "judge": "Judge Michael W. Fitzgerald", "referred_judges": "['Magistrate Judge Sheri Pym']", "case_type_id": "1", "city_id": "217", "court_id": "60", "nature_suit_id": "50", "state_id": "37", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "1.4", "n_docket_reports": "1", "download_url": "https://ecf.cacd.uscourts.gov/cgi-bin/DktRpt.pl?592559090608217-L_1_0-1", "docket_available": "True"}]}
        self.assertEqual(expected_results, results)

    def test_filter_billablePages_range(self):
        # ground truth verified
        opts = {"batchSize": 1}
        json_opts = {
            "query": {
                "AND": [
                    [
                        {"entity": "Case",
                        "field": "billable_pages"},
                        [0,5],
                        "range"
                    ]
                ]
            },
            "relationships": []
        }
        urllink = make_results_url(self.url, self.ringid, self.versionid, "Case", "results", opts)

        resp = requests.get(urllink, headers=self.headers, json=json_opts)

        results = json.loads(resp.content.decode('utf-8'))
        expected_results = {"totalCount": 696993, "page": 0, "batchSize": 1, "activeCacheRange": [0, 10], "results": [{"case_id": "1:05-cv-05137", "ucid": "ilnd;;1:05-cv-05137", "header_case_id": "1:05-cv-05137", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "191306", "recap_id": "None", "monetary_demand": "50000.0", "mdl_code": "None", "billable_pages": "2", "is_mdl": "False", "is_multi": "False", "filing_date": "2005-09-07", "terminating_date": "2006-03-08", "download_timestamp": "2021-05-19 18:04:41", "year": "2005", "case_name": "Patrick v. Home Depot USA, Inc.", "jury_demand": "Defendant", "cause": "28:1441 Petition for Removal- Personal Injury", "jurisdiction": "Diversity", "case_flags": "['MASON']", "case_duration": "182", "judge": "Honorable Harry D. Leinenweber", "referred_judges": "None", "case_type_id": "1", "city_id": "171", "court_id": "52", "nature_suit_id": "14", "state_id": "30", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.2", "n_docket_reports": "1", "download_url": "https://ecf.ilnd.uscourts.gov/cgi-bin/DktRpt.pl?721789794900765-L_1_0-1", "docket_available": "True"}]}
        self.assertEqual(expected_results, results)

    def test_filter_NOS(self):
        # ground truth verified
        opts = {}
        json_opts = {
            "query": {
                "AND": [
                    [
                        {"entity": "NatureOfSuit",
                        "field": "name"},
                        "Copyrights",
                        "exact"
                    ]
                ]
            },
            "relationships": ["CaseToNOS"]
        }
        urllink = make_results_url(self.url, self.ringid, self.versionid, "Case", "results", opts)

        resp = requests.get(urllink, headers=self.headers, json=json_opts)

        results = json.loads(resp.content.decode('utf-8'))
        expected_results = {"totalCount": 10505, "page": 0, "batchSize": 10, "activeCacheRange": [0, 100], "results": [{"case_id": "1:04-cv-03992", "ucid": "ilnd;;1:04-cv-03992", "header_case_id": "1:04-cv-03992", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "148088", "recap_id": "None", "monetary_demand": "150000.0", "mdl_code": "None", "billable_pages": "3", "is_mdl": "False", "is_multi": "False", "filing_date": "2004-06-14", "terminating_date": "2005-01-11", "download_timestamp": "2021-05-17 23:29:15", "year": "2004", "case_name": "Scholz Design Inc v. Mark I Constr, et al", "jury_demand": "Defendant", "cause": "28:1338 Copyright Infringement", "jurisdiction": "Federal Question", "case_flags": "['AO279', 'NOLAN', 'TERMED']", "case_duration": "211", "judge": "Honorable Wayne R. Andersen", "referred_judges": "None", "case_type_id": "1", "city_id": "171", "court_id": "52", "nature_suit_id": "21", "state_id": "30", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.3", "n_docket_reports": "1", "download_url": "https://ecf.ilnd.uscourts.gov/cgi-bin/DktRpt.pl?144281570833506-L_1_0-1", "docket_available": "True"}, {"case_id": "2:17-cv-01380", "ucid": "cacd;;2:17-cv-01380", "header_case_id": "2:17-cv-01380-PA-GJS", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "670842", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "4", "is_mdl": "False", "is_multi": "False", "filing_date": "2017-02-21", "terminating_date": "2017-06-16", "download_timestamp": "2021-07-26 17:22:46", "year": "None", "case_name": "Jitrade, Inc v. Calysta Apparel, Inc et al", "jury_demand": "Plaintiff", "cause": "17:101 Copyright Infringement", "jurisdiction": "Federal Question", "case_flags": "['ACCO', '(GJSx)', 'CLOSED', 'DISCOVERY', 'MANADR']", "case_duration": "115", "judge": "Judge Percy Anderson", "referred_judges": "['Magistrate Judge Gail J. Standish']", "case_type_id": "1", "city_id": "189", "court_id": "60", "nature_suit_id": "21", "state_id": "37", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.4", "n_docket_reports": "1", "download_url": "https://ecf.cacd.uscourts.gov/cgi-bin/DktRpt.pl?10538187718139-L_1_0-1", "docket_available": "True"}, {"case_id": "2:17-cv-01398", "ucid": "cacd;;2:17-cv-01398", "header_case_id": "2:17-cv-01398-GW-JC", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "670882", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "5", "is_mdl": "False", "is_multi": "False", "filing_date": "2017-02-21", "terminating_date": "2017-10-02", "download_timestamp": "2021-07-26 17:24:39", "year": "None", "case_name": "Design Collection Inc v. Bloomingdales Inc et al", "jury_demand": "Plaintiff", "cause": "17:101 Copyright Infringement", "jurisdiction": "Federal Question", "case_flags": "['ACCO', '(JCx)', 'CLOSED', 'DISCOVERY', 'MANADR']", "case_duration": "223", "judge": "Judge George H. Wu", "referred_judges": "['Magistrate Judge Jacqueline Chooljian']", "case_type_id": "1", "city_id": "189", "court_id": "60", "nature_suit_id": "21", "state_id": "37", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.5", "n_docket_reports": "1", "download_url": "https://ecf.cacd.uscourts.gov/cgi-bin/DktRpt.pl?179145071550932-L_1_0-1", "docket_available": "True"}, {"case_id": "4:10-cv-00077", "ucid": "gand;;4:10-cv-00077", "header_case_id": "4:10-cv-00077-HLM", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "2", "is_mdl": "False", "is_multi": "False", "filing_date": "2010-06-10", "terminating_date": "2011-01-03", "download_timestamp": "2019-01-08 19:16:43", "year": "2010", "case_name": "Microsoft Corporation v. Global Computers of Ga., Inc. et al", "jury_demand": "None", "cause": "17:101 Copyright Infringement", "jurisdiction": "Federal Question", "case_flags": "['4months', 'CLOSED']", "case_duration": "207", "judge": "Judge Harold L. Murphy", "referred_judges": "None", "case_type_id": "1", "city_id": "204", "court_id": "54", "nature_suit_id": "21", "state_id": "32", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.2", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}, {"case_id": "2:17-cv-01441", "ucid": "cacd;;2:17-cv-01441", "header_case_id": "2:17-cv-01441-JFW-KS", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "670973", "recap_id": "None", "monetary_demand": "1000000.0", "mdl_code": "None", "billable_pages": "8", "is_mdl": "False", "is_multi": "False", "filing_date": "2017-02-22", "terminating_date": "2017-11-21", "download_timestamp": "2021-07-26 17:28:38", "year": "None", "case_name": "C and SM Int'l v. Ross Stores, Inc. et al", "jury_demand": "Plaintiff", "cause": "17:101 Copyright Infringement", "jurisdiction": "Federal Question", "case_flags": "['ACCO', '(KSx)', 'CLOSED', 'DISCOVERY', 'MANADR', 'PROTORD']", "case_duration": "272", "judge": "Judge John F. Walter", "referred_judges": "['Magistrate Judge Karen L. Stevenson']", "case_type_id": "1", "city_id": "189", "court_id": "60", "nature_suit_id": "21", "state_id": "37", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.8", "n_docket_reports": "1", "download_url": "https://ecf.cacd.uscourts.gov/cgi-bin/DktRpt.pl?112180547714198-L_1_0-1", "docket_available": "True"}, {"case_id": "1:04-cv-04122", "ucid": "ilnd;;1:04-cv-04122", "header_case_id": "1:04-cv-04122", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "148218", "recap_id": "None", "monetary_demand": "0.0", "mdl_code": "None", "billable_pages": "2", "is_mdl": "False", "is_multi": "False", "filing_date": "2004-06-18", "terminating_date": "2005-03-09", "download_timestamp": "2021-05-17 23:31:45", "year": "2004", "case_name": "Capitol Records Inc, et al v. Augusto", "jury_demand": "None", "cause": "17:101 Copyright Infringement", "jurisdiction": "Federal Question", "case_flags": "['AO279', 'BOBRICK']", "case_duration": "264", "judge": "Honorable Matthew F. Kennelly", "referred_judges": "None", "case_type_id": "1", "city_id": "171", "court_id": "52", "nature_suit_id": "21", "state_id": "30", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.2", "n_docket_reports": "1", "download_url": "https://ecf.ilnd.uscourts.gov/cgi-bin/DktRpt.pl?122161645375193-L_1_0-1", "docket_available": "True"}, {"case_id": "2:17-cv-01453", "ucid": "cacd;;2:17-cv-01453", "header_case_id": "2:17-cv-01453-CBM-JC", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "670999", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "7", "is_mdl": "False", "is_multi": "False", "filing_date": "2017-02-22", "terminating_date": "2018-03-22", "download_timestamp": "2021-07-26 17:29:44", "year": "None", "case_name": "NS Intl Textiles v. All Modern Furniture, Inc. et al", "jury_demand": "Plaintiff", "cause": "17:101 Copyright Infringement", "jurisdiction": "Federal Question", "case_flags": "['ACCO', '(JCx)', 'CLOSED', 'DISCOVERY', 'PROTORD']", "case_duration": "393", "judge": "Judge Consuelo B. Marshall", "referred_judges": "['Magistrate Judge Jacqueline Chooljian']", "case_type_id": "1", "city_id": "189", "court_id": "60", "nature_suit_id": "21", "state_id": "37", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.7", "n_docket_reports": "1", "download_url": "https://ecf.cacd.uscourts.gov/cgi-bin/DktRpt.pl?904755234468573-L_1_0-1", "docket_available": "True"}, {"case_id": "2:17-cv-01457", "ucid": "cacd;;2:17-cv-01457", "header_case_id": "2:17-cv-01457-GW-FFM", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "671006", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "3", "is_mdl": "False", "is_multi": "False", "filing_date": "2017-02-22", "terminating_date": "2017-07-17", "download_timestamp": "2021-07-26 17:30:06", "year": "None", "case_name": "Jitrade, Inc. v. Apple Tree Apparel, Inc., et al", "jury_demand": "Plaintiff", "cause": "17:101 Copyright Infringement", "jurisdiction": "Federal Question", "case_flags": "['ACCO', '(FFMx)', 'CLOSED', 'DISCOVERY', 'MANADR']", "case_duration": "145", "judge": "Judge George H. Wu", "referred_judges": "['Magistrate Judge Frederick F. Mumm']", "case_type_id": "1", "city_id": "189", "court_id": "60", "nature_suit_id": "21", "state_id": "37", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.3", "n_docket_reports": "1", "download_url": "https://ecf.cacd.uscourts.gov/cgi-bin/DktRpt.pl?169820946844268-L_1_0-1", "docket_available": "True"}, {"case_id": "2:17-cv-01466", "ucid": "cacd;;2:17-cv-01466", "header_case_id": "2:17-cv-01466-VAP-KS", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "671013", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "5", "is_mdl": "False", "is_multi": "False", "filing_date": "2017-02-22", "terminating_date": "2017-10-27", "download_timestamp": "2021-07-26 17:30:56", "year": "None", "case_name": "C and SM Intl v. A Gaci, LLC et al", "jury_demand": "Plaintiff", "cause": "17:101 Copyright Infringement", "jurisdiction": "Federal Question", "case_flags": "['ACCO', '(KSx)', 'CLOSED', 'DISCOVERY', 'MANADR']", "case_duration": "247", "judge": "Judge Virginia A. Phillips", "referred_judges": "['Magistrate Judge Karen L. Stevenson']", "case_type_id": "1", "city_id": "189", "court_id": "60", "nature_suit_id": "21", "state_id": "37", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.5", "n_docket_reports": "1", "download_url": "https://ecf.cacd.uscourts.gov/cgi-bin/DktRpt.pl?139287179750244-L_1_0-1", "docket_available": "True"}, {"case_id": "4:10-cv-00139", "ucid": "gand;;4:10-cv-00139", "header_case_id": "4:10-cv-00139-HLM", "lead_case_pacer_id": "None", "lead_case_id": "None", "member_case_key": "None", "case_pacer_id": "None", "recap_id": "None", "monetary_demand": "None", "mdl_code": "None", "billable_pages": "3", "is_mdl": "False", "is_multi": "False", "filing_date": "2010-09-03", "terminating_date": "2011-02-14", "download_timestamp": "2019-01-08 19:26:02", "year": "2010", "case_name": "Chandra Rugs, Inc. v. Horizon Home Imports, Inc.", "jury_demand": "Both", "cause": "17:501 Copyright Infringement", "jurisdiction": "Federal Question", "case_flags": "['4months', 'CLOSED']", "case_duration": "164", "judge": "Judge Harold L. Murphy", "referred_judges": "None", "case_type_id": "1", "city_id": "204", "court_id": "54", "nature_suit_id": "21", "state_id": "32", "case_status": "closed", "filed_in_error_text": "None", "mdl_id_source": "None", "source": "pacer", "cost": "0.3", "n_docket_reports": "1", "download_url": "None", "docket_available": "True"}]}
        self.assertEqual(expected_results, results)

if __name__ == '__main__':
    unittest.main()